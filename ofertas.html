<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FIGHT ACADEMY SCORPIONS | Fotos</title>

  <!-- Estilo base + responsive global -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/responsive.css">

  <!-- JS comunes -->
  <script defer src="/assets/js/config.js"></script>
  <script defer src="/assets/js/menu.js"></script>
  <script defer src="/assets/js/header.js"></script>

  <style>
    /* Ajustes propios de esta página (el resto está en styles.css + responsive.css) */
    .photos{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    @media(min-width:720px){.photos{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}}
    .photo-card{border:1px solid var(--c-border);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0))}
    .photo{width:100%;aspect-ratio:4/3;object-fit:cover;display:block;background:#0b0d11}
    .body{padding:12px}
    .title{margin:0}
    .empty{opacity:.85;padding:12px}
    .social-gym a{margin-right:10px}
    .banner{margin-bottom:16px}
  </style>
</head>
<body>

<!-- NAV -->
<nav class="site-nav">
  <a class="brand" href="index.html" aria-label="Inicio">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 3l3 6 6 .9-4.5 4.2 1 6.9L12 18l-5.5 3 1-6.9L3 9.9 9 9z" stroke="url(#g)" stroke-width="1.5"/>
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#22c55e"/>
          <stop offset="1" stop-color="#14b8a6"/>
        </linearGradient>
      </defs>
    </svg>
    <span>FIGHT ACADEMY SCORPIONS</span>
  </a>

  <button class="nav-toggle" aria-expanded="false" aria-controls="nav-links" aria-label="Abrir menú">☰</button>

  <div id="nav-links" class="nav-links">
    <a class="nav-link" href="disciplinas.html">Disciplinas</a>
    <a class="nav-link active" href="fotos.html">Fotos</a>
    <a class="nav-link" href="videos.html">Videos</a>
    <a class="nav-link" href="ofertas.html">Ofertas</a>
    <a class="nav-link" href="promociones.html">Promociones</a>
    <a class="nav-link" href="ventas.html">Ventas</a>
    <a class="nav-link" href="equipo.html">Equipo</a>

    <!-- Submenú Ingresos -->
    <div class="menu" id="menu-ingresos">
      <button class="toggle" aria-expanded="false">Ingresos ▾</button>
      <div class="submenu" hidden>
        <a href="https://multi-gimnasio-51bq.onrender.com/login.php" target="_blank" rel="noopener">App (General)</a>
        <a href="https://multi-gimnasio-51bq.onrender.com/cliente_acceso.php" target="_blank" rel="noopener">Ingreso Clientes</a>
        <a href="https://multi-gimnasio-51bq.onrender.com/login_profesor.php" target="_blank" rel="noopener">Ingreso Profesores</a>
        <!-- Configuraciones (corrige el typo y usa ruta local en dev) -->
        <a id="ing-config" href="/admin/configuraciones.php" target="_blank" rel="noopener">Configuraciones</a>
      </div>
    </div>

    <a class="btn btn-ghost" href="contacto.html">Contacto</a>
  </div>
</nav>

<main class="container">
  <h1>Fotos</h1>

  <!-- Banner desde Configuraciones (texto_banner) -->
  <section id="site-banner" class="card banner" hidden>
    <p id="banner-text" class="m-0"></p>
  </section>

  <!-- Redes desde Configuraciones -->
  <section class="card">
    <h2>Seguinos</h2>
    <p class="text-muted m-0">Enlaces cargados automáticamente desde Configuraciones.</p>
    <p class="social-gym mt-2" id="gym-social"></p>
  </section>

  <!-- Galería -->
  <section class="photos" id="photos">
    <div class="empty">Cargando fotos…</div>
  </section>
</main>

<footer><small>© 2025 FIGHT ACADEMY SCORPIONS — San Luis, Argentina.</small></footer>

<script>
(function(){
  // ==== Endpoints ====
  const API_FOTOS_OPTIONS = [
    `${location.origin}/api.php?sec=fotos&active=1&limit=200`,
    `/api/fotos.php`,                                  // alternativo
    `${location.origin}/api.php?sec=galeria&limit=200` // por si usan otro "sec"
  ];

  const API_SETTINGS_OPTIONS = [
    `${location.origin}/api.php?sec=settings`,
    `${location.origin}/api.php?sec=site_settings`,
    `${location.origin}/api.php?sec=config`,
  ];

  const box = document.getElementById('photos');
  const social = document.getElementById('gym-social');
  const bannerWrap = document.getElementById('site-banner');
  const bannerText = document.getElementById('banner-text');

  // ==== Cargar fotos ====
  getFirstJSON(API_FOTOS_OPTIONS).then(d=>{
    const items = normList(d);
    if(!items.length){ box.innerHTML = '<div class="empty">Pronto nuevas fotos.</div>'; return; }

    // Ordenar como en el panel: orden ASC, id DESC
    items.sort((a,b)=>{
      const ao = Number(a.orden||0), bo = Number(b.orden||0);
      if (ao!==bo) return ao-bo;
      return Number(b.id||0) - Number(a.id||0);
    });

    box.innerHTML = items.map(f => card(f)).join('');
  }).catch(()=>{
    if (box) box.innerHTML = '<div class="empty">No se pudieron cargar las fotos.</div>';
  });

  function card(f){
    const titulo = esc(f.titulo || '');
    const url    = escA(f.imagen_url || '');
    return `
      <article class="photo-card">
        ${url ? `<a href="${url}" target="_blank" rel="noopener">
                   <img class="photo" src="${url}" alt="${titulo}">
                 </a>` : `<div class="photo" aria-hidden="true"></div>`}
        <div class="body">
          ${titulo ? `<h3 class="title">${titulo}</h3>` : ''}
        </div>
      </article>`;
  }

  // ==== Configuraciones (redes + banner) ====
  getFirstJSON(API_SETTINGS_OPTIONS).then(cfg=>{
    if(!cfg) return;

    // Redes
    const links = [];
    if (cfg.youtube)   links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.youtube)}">YouTube</a>`);
    if (cfg.instagram) links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.instagram)}">Instagram</a>`);
    if (cfg.facebook)  links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.facebook)}">Facebook</a>`);
    if (links.length && social) social.innerHTML = links.join(' ');

    // Banner
    if (cfg.texto_banner && bannerWrap && bannerText){
      bannerText.textContent = String(cfg.texto_banner);
      bannerWrap.hidden = false;
    }
  });

  // ==== Helpers ====
  async function getFirstJSON(options){
    for(const url of options){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if(!r.ok) continue;
        const j = await r.json();
        if (j) return j;
      }catch(_){/* siguiente opción */}
    }
    // Último recurso: config.js podría exponer __CFG
    return (window.__CFG && window.__CFG.settings) || null;
  }

  function normList(payload){
    if (!payload) return [];
    if (Array.isArray(payload)) return payload;
    if (Array.isArray(payload.items)) return payload.items;
    if (Array.isArray(payload.data)) return payload.data;
    return [];
  }

  function esc(s){return String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]))}
  function escA(s){return String(s||'').replace(/"/g,'&quot;')}

})();
</script>
</body>
</html>
