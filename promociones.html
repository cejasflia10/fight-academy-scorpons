<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FIGHT ACADEMY SCORPIONS | Promociones</title>

  <!-- Estilo base + responsive global -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/responsive.css">

  <!-- JS comunes -->
  <script defer src="/assets/js/config.js"></script>
  <script defer src="/assets/js/menu.js"></script>
  <script defer src="/assets/js/header.js"></script>

  <style>
    /* Ajustes específicos de esta página */
    .promos{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    @media(min-width:720px){.promos{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}}
    .promo{border:1px solid var(--c-border);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0))}
    .promo .img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block;background:#0b0d11}
    .promo .body{padding:12px}
    .promo .title{margin:0}
    .meta{color:#9aa3b2;font-size:.9rem}
    .empty{opacity:.85;padding:12px}
    .social-gym a{margin-right:10px}
    .banner{margin-bottom:16px}
  </style>
</head>
<body>

<!-- NAV -->
<nav class="site-nav">
  <a class="brand" href="index.html" aria-label="Inicio">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 3l3 6 6 .9-4.5 4.2 1 6.9L12 18l-5.5 3 1-6.9L3 9.9 9 9z" stroke="url(#g)" stroke-width="1.5"/>
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#22c55e"/>
          <stop offset="1" stop-color="#14b8a6"/>
        </linearGradient>
      </defs>
    </svg>
    <span>FIGHT ACADEMY SCORPIONS</span>
  </a>

  <button class="nav-toggle" aria-expanded="false" aria-controls="nav-links" aria-label="Abrir menú">☰</button>

  <div id="nav-links" class="nav-links">
    <a class="nav-link" href="disciplinas.html">Disciplinas</a>
    <a class="nav-link" href="fotos.html">Fotos</a>
    <a class="nav-link" href="videos.html">Videos</a>
    <a class="nav-link" href="ofertas.html">Ofertas</a>
    <a class="nav-link active" href="promociones.html">Promociones</a>
    <a class="nav-link" href="ventas.html">Ventas</a>
    <a class="nav-link" href="equipo.html">Equipo</a>

    <!-- Submenú Ingresos -->
    <div class="menu" id="menu-ingresos">
      <button class="toggle" aria-expanded="false">Ingresos ▾</button>
      <div class="submenu" hidden>
        <a href="https://multi-gimnasio-51bq.onrender.com/login.php" target="_blank" rel="noopener">App (General)</a>
        <a href="https://multi-gimnasio-51bq.onrender.com/cliente_acceso.php" target="_blank" rel="noopener">Ingreso Clientes</a>
        <a href="https://multi-gimnasio-51bq.onrender.com/login_profesor.php" target="_blank" rel="noopener">Ingreso Profesores</a>
        <!-- Configuraciones: local vs producción -->
        <a id="ing-config"
           href="/admin/configuraciones.php"
           data-prod="https://fight-academy-scorpons.onrender.com/admin/configuraciones.php"
           target="_blank" rel="noopener">Configuraciones</a>
      </div>
    </div>

    <a class="btn btn-ghost" href="contacto.html">Contacto</a>
  </div>
</nav>

<main class="container">
  <h1>Promociones</h1>

  <!-- Banner desde Configuraciones -->
  <section id="site-banner" class="card banner" hidden>
    <p id="banner-text" class="m-0"></p>
  </section>

  <!-- Redes desde Configuraciones -->
  <section class="card">
    <h2>Seguinos</h2>
    <p class="text-muted m-0">Enlaces cargados automáticamente desde Configuraciones.</p>
    <p class="social-gym mt-2" id="gym-social"></p>
  </section>

  <!-- Listado de promos -->
  <section class="promos" id="promos">
    <div class="empty">Cargando promociones…</div>
  </section>
</main>

<footer><small>© 2025 FIGHT ACADEMY SCORPIONS — San Luis, Argentina.</small></footer>

<script>
(function(){
  // ===== Endpoints candidatos =====
  const API_PROMOS_OPTIONS = [
    `${location.origin}/api.php?sec=promociones&active=1&limit=200`,
    `/api/promociones.php`
  ];
  const API_SETTINGS_OPTIONS = [
    `${location.origin}/api.php?sec=settings`,
    `${location.origin}/api.php?sec=site_settings`,
    `${location.origin}/api.php?sec=config`
  ];

  const box = document.getElementById('promos');
  const social = document.getElementById('gym-social');
  const bannerWrap = document.getElementById('site-banner');
  const bannerText = document.getElementById('banner-text');

  // ===== Cargar promociones =====
  getFirstJSON(API_PROMOS_OPTIONS).then(d=>{
    const items = normList(d);

    // Ordenar como en el panel: orden ASC, id DESC
    items.sort((a,b)=>{
      const ao = Number(a.orden||0), bo = Number(b.orden||0);
      if (ao!==bo) return ao-bo;
      return Number(b.id||0) - Number(a.id||0);
    });

    if(!items.length){ box.innerHTML = '<div class="empty">Pronto nuevas promociones.</div>'; return; }
    box.innerHTML = items.map(p => card(p)).join('');
  }).catch(()=>{
    if (box) box.innerHTML = '<div class="empty">No se pudieron cargar las promociones.</div>';
  });

  function card(p){
    const t = esc(p.titulo||'');
    const d = esc(p.descripcion||'');
    const img = escA(p.imagen_url||'');
    return `
      <article class="promo">
        ${img ? `<img class="img" src="${img}" alt="${t}">` : `<div class="img" aria-hidden="true"></div>`}
        <div class="body">
          ${t?`<h3 class="title">${t}</h3>`:''}
          ${d?`<p class="meta">${d}</p>`:''}
        </div>
      </article>`;
  }

  // ===== Configuraciones (redes + banner) =====
  getFirstJSON(API_SETTINGS_OPTIONS).then(cfg=>{
    if(!cfg) return;

    // Redes
    const links = [];
    if (cfg.youtube)   links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.youtube)}">YouTube</a>`);
    if (cfg.instagram) links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.instagram)}">Instagram</a>`);
    if (cfg.facebook)  links.push(`<a class="btn-ghost" target="_blank" rel="noopener" href="${escA(cfg.facebook)}">Facebook</a>`);
    if (links.length && social) social.innerHTML = links.join(' ');

    // Banner
    if (cfg.texto_banner && bannerWrap && bannerText){
      bannerText.textContent = String(cfg.texto_banner);
      bannerWrap.hidden = false;
    }
  });

  // ===== Ajustar link de Configuraciones según entorno =====
  (function(){
    const a = document.getElementById('ing-config');
    if (!a) return;
    const host = (location.hostname||'').toLowerCase();
    const isProd = host.includes('onrender.com');
    const prod = a.getAttribute('data-prod') || 'https://fight-academy-scorpons.onrender.com/admin/configuraciones.php';
    a.href = isProd ? prod : '/admin/configuraciones.php';
  })();

  // ===== Marcar nav activo =====
  (function(){
    const current = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('.nav-links .nav-link').forEach(a=>{
      const href = (a.getAttribute('href')||'').toLowerCase();
      if (href.endsWith(current)) a.classList.add('active');
    });
  })();

  // ===== Helpers =====
  async function getFirstJSON(options){
    for(const url of options){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if(!r.ok) continue;
        const j = await r.json();
        if (j) return j;
      }catch(_){}
    }
    // Último recurso: config.js podría exponer __CFG
    return (window.__CFG && window.__CFG.settings) || null;
  }
  function normList(payload){
    if (!payload) return [];
    if (Array.isArray(payload)) return payload;
    if (Array.isArray(payload.items)) return payload.items;
    if (Array.isArray(payload.data)) return payload.data;
    return [];
  }
  function esc(s){return String(s).replace(/[&<>]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]))}
  function escA(s){return String(s||'').replace(/"/g,'&quot;')}
})();
</script>
</body>
</html>
